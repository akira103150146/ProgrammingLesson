8. Kahan Summation：高精度累加
觀念講解

標準累加對於浮點誤差會「一點點」累積。

Kahan 演算法引入「補償變數」，可大幅減少累加誤差。

cpp
複製
編輯
#include <iostream>
#include <vector>
using namespace std;

double kahan_sum(const vector<double>& v) {
    double sum = 0.0, c = 0.0;   // c：補償誤差
    for (double x : v) {
        double y = x - c;
        double t = sum + y;
        c = (t - sum) - y;
        sum = t;
    }
    return sum;
}

int main() {
    vector<double> v(1000000, 0.000001);
    // 標準累加
    double naive = 0.0;
    for (auto x : v) naive += x;
    // Kahan 累加
    double better = kahan_sum(v);
    cout << "naive = " << naive << endl;
    cout << "kahan = " << better << endl;
    return 0;
}